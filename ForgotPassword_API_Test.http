### Forgot Password API Tests

# Base URL
@baseUrl = https://localhost:7001

### 1. Forgot Password - Valid Email
# Description: Request password reset for a valid email
POST {{baseUrl}}/api/Auth/forgot-password
Content-Type: application/json

{
  "email": "phamtand75@gmail.com"
}

###

### 2. Forgot Password - Invalid Email Format
# Description: Test with invalid email format
POST {{baseUrl}}/api/Auth/forgot-password
Content-Type: application/json

{
  "email": "invalid-email-format"
}

###

### 3. Forgot Password - Non-existent Email
# Description: Test with email that doesn't exist in database
POST {{baseUrl}}/api/Auth/forgot-password
Content-Type: application/json

{
  "email": "nonexistent@example.com"
}

###

### 4. Forgot Password - Empty Email
# Description: Test with empty email
POST {{baseUrl}}/api/Auth/forgot-password
Content-Type: application/json

{
  "email": ""
}

###

### 5. Forgot Password - Missing Email Field
# Description: Test with missing email field
POST {{baseUrl}}/api/Auth/forgot-password
Content-Type: application/json

{
}

###

### 6. Reset Password - Valid Token and Password
# Description: Reset password with valid token (you need to get token from email first)
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "token": "your-reset-token-here",
  "newPassword": "newPassword123"
}

###

### 7. Reset Password - Invalid Token
# Description: Test with invalid token
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "token": "invalid-token-123",
  "newPassword": "newPassword123"
}

###

### 8. Reset Password - Short Password
# Description: Test with password shorter than 6 characters
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "token": "your-reset-token-here",
  "newPassword": "123"
}

###

### 9. Reset Password - Missing Token
# Description: Test with missing token
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "newPassword": "newPassword123"
}

###

### 10. Reset Password - Missing Password
# Description: Test with missing password
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "token": "your-reset-token-here"
}

###

### 11. Reset Password - Same Password as Current
# Description: Test with new password same as current password
POST {{baseUrl}}/api/Auth/reset-password
Content-Type: application/json

{
  "token": "your-reset-token-here",
  "newPassword": "currentPassword123"
}

###

## Test Instructions

1. **Start with Forgot Password**: Use endpoint 1 to request password reset
2. **Check Email**: Check the email for reset link (if using real email)
3. **Extract Token**: Get the token from the reset link URL
4. **Reset Password**: Use endpoint 6 with the extracted token
5. **Test Error Cases**: Use other endpoints to test error scenarios

## Expected Responses

### Success Cases:
- **Forgot Password**: 200 OK with "Password reset email sent"
- **Reset Password**: 200 OK with "Password has been reset successfully"

### Error Cases:
- **Invalid Email**: 400 Bad Request with validation error
- **Non-existent Email**: 400 Bad Request with "Email not found"
- **Inactive User**: 400 Bad Request with "User account is not active"
- **Invalid Token**: 400 Bad Request with "Invalid or expired token"
- **Short Password**: 400 Bad Request with validation error
- **Same Password**: 400 Bad Request with "New password must be different from the current password"
- **Email Configuration Error**: 500 Internal Server Error with email configuration details

## New Features Added

### ForgotPasswordAsync:
- ✅ Kiểm tra user có active không
- ✅ Xóa các token cũ trước khi tạo token mới
- ✅ Email template đẹp hơn với HTML formatting
- ✅ Xử lý lỗi khi gửi email thất bại
- ✅ Xóa token nếu gửi email thất bại

### ResetPasswordAsync:
- ✅ Kiểm tra user có active không
- ✅ Kiểm tra password mới có khác password cũ không
- ✅ Gửi email thông báo reset password thành công
- ✅ Xử lý lỗi gửi email confirmation

### EmailHelper:
- ✅ Validation đầy đủ cho các tham số
- ✅ Kiểm tra cấu hình email service
- ✅ Xử lý lỗi chi tiết hơn

## Notes

- The reset token expires after 1 hour
- The reset link format is: `http://localhost:3000/reset-password?token={token}`
- Email service must be configured properly in appsettings.json
- Test with real email addresses that exist in your database
- Old unused tokens are automatically cleaned up when requesting new reset
- Users receive confirmation email when password is successfully reset 